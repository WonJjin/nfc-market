<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ›’ ì‹œì¥ë†€ì´ NFC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'Malgun Gothic', cursive, sans-serif;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            min-height: 100vh;
            padding: 15px;
            color: #333;
        }

        .app-container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .header {
            background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .nfc-panel {
            background: #fff;
            padding: 25px 20px;
        }

        .nfc-status {
            background: #74b9ff;
            color: white;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.1em;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .nfc-status.ready {
            background: #00b894;
            animation: pulse 2s infinite;
        }

        .nfc-status.error {
            background: #d63031;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 184, 148, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 184, 148, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 184, 148, 0); }
        }

        .start-btn {
            width: 100%;
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 15px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .start-btn:disabled {
            background: #ddd;
            cursor: not-allowed;
            transform: none;
        }

        .cart-section {
            background: #f8f9fa;
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            min-height: 250px;
        }

        .cart-title {
            font-size: 1.8em;
            color: #2d3436;
            text-align: center;
            margin-bottom: 15px;
        }

        .cart-items {
            background: white;
            border-radius: 15px;
            padding: 15px;
            min-height: 150px;
            border: 2px dashed #ddd;
        }

        .cart-item {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 12px 18px;
            margin: 8px 0;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: bold;
            color: #2d3436;
            animation: bounceIn 0.6s ease-out;
            border-left: 4px solid #e17055;
        }

        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }

        .empty-cart {
            text-align: center;
            color: #636e72;
            font-size: 1.3em;
            padding: 40px 20px;
            line-height: 1.6;
        }

        .controls {
            padding: 20px;
            text-align: center;
        }

        .clear-btn {
            background: #e17055;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }

        .clear-btn:hover {
            background: #d63031;
            transform: translateY(-2px);
        }

        .test-btn {
            background: #6c5ce7;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 15px;
            font-size: 0.9em;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .test-btn:hover {
            background: #5f3dc4;
            transform: translateY(-1px);
        }

        .payment-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .payment-content {
            background: white;
            padding: 40px 30px;
            border-radius: 25px;
            text-align: center;
            max-width: 350px;
            margin: 20px;
            animation: zoomIn 0.3s ease-out;
        }

        @keyframes zoomIn {
            0% { opacity: 0; transform: scale(0.3); }
            100% { opacity: 1; transform: scale(1); }
        }

        .payment-content h2 {
            font-size: 2.5em;
            color: #00b894;
            margin-bottom: 20px;
        }

        .payment-content p {
            font-size: 1.3em;
            color: #2d3436;
            margin-bottom: 10px;
        }

        .instructions {
            background: #e8f4f8;
            border: 2px solid #74b9ff;
            border-radius: 15px;
            padding: 15px;
            margin: 15px 20px;
            font-size: 0.95em;
            color: #2d3436;
            line-height: 1.5;
        }

        .debug-info {
            background: #f1f3f4;
            border-radius: 10px;
            padding: 10px;
            margin: 10px 20px;
            font-size: 0.8em;
            color: #636e72;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>ğŸ›’ ì‹œì¥ë†€ì´</h1>
            <p>NFCë¡œ ì‡¼í•‘í•´ë³´ì!</p>
        </div>

        <div class="nfc-panel">
            <div class="nfc-status" id="status">
                ğŸ” NFC í™•ì¸ ì¤‘...
            </div>
            
            <button class="start-btn" id="startBtn" onclick="startNFC()">
                ğŸš€ NFC ì‹œì‘í•˜ê¸°
            </button>

            <div class="instructions">
                <strong>ğŸ“‹ ì‚¬ìš©ë°©ë²•:</strong><br>
                â€¢ ìƒí’ˆíƒœê·¸: "ìƒí’ˆ:ì‚¬ê³¼ 1000ì›" í˜•ì‹ìœ¼ë¡œ ì‘ì„±<br>
                â€¢ ê²°ì œíƒœê·¸: "ê²°ì œ" ë¼ê³ ë§Œ ì‘ì„±<br>
                â€¢ íƒœê·¸ë¥¼ íœ´ëŒ€í° ë’·ë©´ì— ê°€ê¹Œì´ ëŒ€ì„¸ìš”
            </div>
        </div>

        <div class="cart-section">
            <h2 class="cart-title">ğŸ›ï¸ ì¥ë°”êµ¬ë‹ˆ</h2>
            <div class="cart-items" id="cartItems">
                <div class="empty-cart">
                    ğŸ›’<br>
                    ì•„ì§ ìƒí’ˆì´ ì—†ì–´ìš”<br>
                    <small>NFC íƒœê·¸ë¥¼ ëŒ€ë³´ì„¸ìš”!</small>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="clear-btn" onclick="clearCart()">
                ğŸ—‘ï¸ ë¹„ìš°ê¸°
            </button>
            
            <div style="margin-top: 15px;">
                <small style="color: #636e72;">í…ŒìŠ¤íŠ¸ìš© ë²„íŠ¼:</small><br>
                <button class="test-btn" onclick="addTestItem('ì‚¬ê³¼ 1000ì›')">ğŸ ì‚¬ê³¼</button>
                <button class="test-btn" onclick="addTestItem('ë°”ë‚˜ë‚˜ 800ì›')">ğŸŒ ë°”ë‚˜ë‚˜</button>
                <button class="test-btn" onclick="processPayment()">ğŸ’³ ê²°ì œ</button>
            </div>
        </div>

        <div class="debug-info" id="debug">
            ëŒ€ê¸° ì¤‘...
        </div>
    </div>

    <div class="payment-modal" id="paymentModal">
        <div class="payment-content">
            <h2>ğŸ‰</h2>
            <p><strong>ê²°ì œ ì™„ë£Œ!</strong></p>
            <p>ì¦ê±°ìš´ ì‡¼í•‘ì´ì—ˆì–´ìš”! ğŸ˜Š</p>
        </div>
    </div>

    <script>
        let nfcReader = null;
        let cartItems = [];
        let isNFCActive = false;

        // íš¨ê³¼ìŒ í•¨ìˆ˜ë“¤
        function playBeep() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                
                osc.connect(gain);
                gain.connect(ctx.destination);
                
                osc.frequency.setValueAtTime(800, ctx.currentTime);
                osc.type = 'square';
                
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                
                osc.start(ctx.currentTime);
                osc.stop(ctx.currentTime + 0.2);
            } catch (e) {
                console.log('íš¨ê³¼ìŒ ì¬ìƒ ì‹¤íŒ¨:', e);
            }
        }

        function playChime() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                
                [523, 659, 784].forEach((freq, i) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    
                    osc.frequency.setValueAtTime(freq, ctx.currentTime + i * 0.15);
                    osc.type = 'sine';
                    
                    gain.gain.setValueAtTime(0.1, ctx.currentTime + i * 0.15);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + i * 0.15 + 0.3);
                    
                    osc.start(ctx.currentTime + i * 0.15);
                    osc.stop(ctx.currentTime + i * 0.15 + 0.3);
                });
            } catch (e) {
                console.log('ì°¨ì„ ì¬ìƒ ì‹¤íŒ¨:', e);
            }
        }

        // ë””ë²„ê·¸ ë¡œê·¸
        function log(message) {
            const debugDiv = document.getElementById('debug');
            const time = new Date().toLocaleTimeString();
            debugDiv.innerHTML = `[${time}] ${message}`;
            console.log(message);
        }

        // NFC ì§€ì› í™•ì¸
        function checkNFCSupport() {
            const statusDiv = document.getElementById('status');
            
            if (!('NDEFReader' in window)) {
                statusDiv.textContent = 'âŒ Web NFC ë¯¸ì§€ì›';
                statusDiv.className = 'nfc-status error';
                log('Web NFC APIê°€ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
                return false;
            }
            
            if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                statusDiv.textContent = 'ğŸ”’ HTTPS í•„ìš”';
                statusDiv.className = 'nfc-status error';
                log('HTTPS í™˜ê²½ì´ í•„ìš”í•©ë‹ˆë‹¤');
                return false;
            }
            
            statusDiv.textContent = 'âœ… NFC ì‚¬ìš© ê°€ëŠ¥';
            statusDiv.className = 'nfc-status';
            log('NFC ì§€ì› í™•ì¸ë¨');
            return true;
        }

        // NFC ì‹œì‘
        async function startNFC() {
            const statusDiv = document.getElementById('status');
            const startBtn = document.getElementById('startBtn');
            
            if (isNFCActive) {
                stopNFC();
                return;
            }
            
            try {
                log('NFC ì‹œì‘ ì‹œë„...');
                startBtn.disabled = true;
                statusDiv.textContent = 'ğŸ”„ NFC ê¶Œí•œ ìš”ì²­ ì¤‘...';
                
                nfcReader = new NDEFReader();
                await nfcReader.scan();
                
                isNFCActive = true;
                statusDiv.textContent = 'ğŸ“± NFC í™œì„±! íƒœê·¸ë¥¼ ëŒ€ë³´ì„¸ìš”';
                statusDiv.className = 'nfc-status ready';
                startBtn.textContent = 'â¹ï¸ NFC ì •ì§€';
                startBtn.disabled = false;
                
                log('NFC ìŠ¤ìº” ì‹œì‘ë¨');
                
                nfcReader.addEventListener('reading', handleNFCRead);
                nfcReader.addEventListener('readingerror', handleNFCError);
                
            } catch (error) {
                log(`NFC ì‹œì‘ ì‹¤íŒ¨: ${error.name} - ${error.message}`);
                
                let errorMsg = 'âŒ NFC ì˜¤ë¥˜';
                if (error.name === 'NotAllowedError') {
                    errorMsg = 'ğŸš« NFC ê¶Œí•œ ê±°ë¶€ë¨';
                } else if (error.name === 'NotSupportedError') {
                    errorMsg = 'ğŸ“± ê¸°ê¸° ë¯¸ì§€ì›';
                } else if (error.name === 'InvalidStateError') {
                    errorMsg = 'âš ï¸ NFC ìƒíƒœ ì˜¤ë¥˜';
                }
                
                statusDiv.textContent = errorMsg;
                statusDiv.className = 'nfc-status error';
                startBtn.disabled = false;
                isNFCActive = false;
            }
        }

        // NFC ì •ì§€
        function stopNFC() {
            if (nfcReader) {
                nfcReader.removeEventListener('reading', handleNFCRead);
                nfcReader.removeEventListener('readingerror', handleNFCError);
                nfcReader = null;
            }
            
            isNFCActive = false;
            document.getElementById('status').textContent = 'â¹ï¸ NFC ì •ì§€ë¨';
            document.getElementById('status').className = 'nfc-status';
            document.getElementById('startBtn').textContent = 'ğŸš€ NFC ì‹œì‘í•˜ê¸°';
            log('NFC ì •ì§€ë¨');
        }

        // NFC ì½ê¸° ì²˜ë¦¬
        function handleNFCRead(event) {
            log(`NFC íƒœê·¸ ê°ì§€: ${event.serialNumber}`);
            
            for (const record of event.message.records) {
                if (record.recordType === 'text') {
                    try {
                        const textDecoder = new TextDecoder(record.encoding || 'utf-8');
                        const text = textDecoder.decode(record.data);
                        log(`ì½ì€ í…ìŠ¤íŠ¸: "${text}"`);
                        processNFCData(text.trim());
                    } catch (e) {
                        log(`í…ìŠ¤íŠ¸ ë””ì½”ë”© ì˜¤ë¥˜: ${e.message}`);
                    }
                }
            }
        }

        // NFC ì˜¤ë¥˜ ì²˜ë¦¬
        function handleNFCError(event) {
            log(`NFC ì½ê¸° ì˜¤ë¥˜: ${event.error?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
        }

        // NFC ë°ì´í„° ì²˜ë¦¬
        function processNFCData(text) {
            if (text === 'ê²°ì œ') {
                playChime();
                processPayment();
            } else if (text.startsWith('ìƒí’ˆ:')) {
                const item = text.replace('ìƒí’ˆ:', '');
                playBeep();
                addToCart(item);
            } else {
                log(`ì•Œ ìˆ˜ ì—†ëŠ” NFC ë°ì´í„°: "${text}"`);
            }
        }

        // ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€
        function addToCart(item) {
            cartItems.push(item);
            updateCartDisplay();
            log(`ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€: ${item}`);
        }

        // ì¥ë°”êµ¬ë‹ˆ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateCartDisplay() {
            const container = document.getElementById('cartItems');
            
            if (cartItems.length === 0) {
                container.innerHTML = `
                    <div class="empty-cart">
                        ğŸ›’<br>
                        ì•„ì§ ìƒí’ˆì´ ì—†ì–´ìš”<br>
                        <small>NFC íƒœê·¸ë¥¼ ëŒ€ë³´ì„¸ìš”!</small>
                    </div>
                `;
            } else {
                container.innerHTML = cartItems.map((item, i) => `
                    <div class="cart-item">
                        ğŸ›ï¸ ${item}
                    </div>
                `).join('');
            }
        }

        // ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸°
        function clearCart() {
            cartItems = [];
            updateCartDisplay();
            log('ì¥ë°”êµ¬ë‹ˆ ë¹„ì›€');
        }

        // ê²°ì œ ì²˜ë¦¬
        function processPayment() {
            if (cartItems.length === 0) {
                log('ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆì–´ ê²°ì œ ë¶ˆê°€');
                return;
            }
            
            const modal = document.getElementById('paymentModal');
            modal.style.display = 'flex';
            
            setTimeout(() => {
                modal.style.display = 'none';
                clearCart();
            }, 2500);
            
            log(`ê²°ì œ ì™„ë£Œ: ${cartItems.length}ê°œ ìƒí’ˆ`);
        }

        // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        function addTestItem(item) {
            playBeep();
            addToCart(item);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', () => {
            log('ì•± ì‹œì‘ë¨');
            checkNFCSupport();
        });

        // ëª¨ë‹¬ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('paymentModal').addEventListener('click', (e) => {
            if (e.target.id === 'paymentModal') {
                e.target.style.display = 'none';
            }
        });
    </script>
</body>
</html>
